{% extends "base.html" %}
{% block title %}{{ category.name }} - Blog{% endblock %}
{% block content %}
<div class="container blog-category-page">
  <section class="page-content">
    <div class="category-header">
      <h1>{{ category.name }}</h1>
      {% if category.description %}
        <p class="category-description">{{ category.description }}</p>
      {% endif %}
    </div>
    <hr class="accent-hr">
    
    <!-- Categories Navigation -->
    {% if categories %}
      <div class="categories-nav">
        <a href="{{ url_for('blog.blog') }}" class="category-link">All Posts</a>
        {% for cat in categories %}
          <a href="{{ url_for('blog.by_category', slug=cat.slug) }}" class="category-link {% if cat.slug == category.slug %}active{% endif %}">{{ cat.name }}</a>
        {% endfor %}
      </div>
    {% endif %}
    
    <!-- Blog Posts -->
    {% if posts %}
      <div class="posts-grid">
        {% for post in posts %}
          <article class="post-card">
            {% if post.image_data %}
              <div class="post-image">
                <img src="{{ url_for('admin.post_image', post_hex_id=post.hex_id) }}" alt="{{ post.title }}" loading="lazy">
              </div>
            {% endif %}
            <div class="post-content">
              <div class="post-meta">
                <span class="post-category">{{ category.name }}</span>
                <time class="post-date">{{ post.created_at.strftime('%B %d, %Y') if post.created_at else 'Unknown date' }}</time>
              </div>
              <h2 class="post-title">
                <a href="{{ url_for('blog.post_detail', slug=post.slug) }}">{{ post.title }}</a>
              </h2>
              {% if post.excerpt %}
                <p class="post-excerpt">{{ post.excerpt }}</p>
              {% endif %}
              <a href="{{ url_for('blog.post_detail', slug=post.slug) }}" class="read-more">Read More →</a>
            </div>
          </article>
        {% endfor %}
      </div>
      
      <!-- Pagination -->
      {% if total > per_page %}
        <div class="pagination">
          {% if page > 1 %}
            <a href="{{ url_for('blog.by_category', slug=category.slug, page=page-1) }}" class="pagination-link">← Previous</a>
          {% endif %}
          
          {% for p in range(1, (total // per_page) + 2) %}
            {% if p == page %}
              <span class="pagination-current">{{ p }}</span>
            {% else %}
              <a href="{{ url_for('blog.by_category', slug=category.slug, page=p) }}" class="pagination-link">{{ p }}</a>
            {% endif %}
          {% endfor %}
          
          {% if page < (total // per_page) + 1 %}
            <a href="{{ url_for('blog.by_category', slug=category.slug, page=page+1) }}" class="pagination-link">Next →</a>
          {% endif %}
        </div>
      {% endif %}
    {% else %}
      <div class="no-posts">
        <h3>No posts in this category yet</h3>
        <p>Check back soon for new content!</p>
        <a href="{{ url_for('blog.blog') }}" class="back-to-blog">← Back to All Posts</a>
      </div>
    {% endif %}
  </section>
</div>

{% endblock %}
